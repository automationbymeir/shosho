/* =====================================================
   PHOTO BOOK CREATOR - ARCHIVAL VINTAGE DESIGN SYSTEM
   ===================================================== */

/* Variables & Design Tokens - Vintage Aesthetic */
:root {
  /* Vintage Color Palette - Archival Library */
  --color-bg: #F9F7F1;
  /* Cream/Paper background - aged parchment */
  --color-bg-alt: #EFEBDF;
  /* Darker paper - aged ledger */
  --color-surface: #FFFFFF;
  /* Clean white surface */
  --color-primary: #2C3E50;
  /* Vintage Navy - ink on paper */
  --color-accent: #8B4513;
  /* Leather Brown - book binding */
  --color-accent-light: #D2B48C;
  /* Tan - worn leather */
  --color-secondary: #556B2F;
  /* Olive Green - botanical illustrations */
  --color-text-main: #1A1A1A;
  /* Soft Black ink - readable but soft */
  --color-text-light: #595959;
  /* Faded ink - secondary text */
  --color-border: #D1C7B7;
  /* Aged paper edge */
  --color-danger: #8B0000;
  /* Dried Blood Red - errors */
  --color-success: #556B2F;
  /* Natural Green - success states */

  /* Typography - Letterpress & Serif */
  --font-serif: 'Playfair Display', 'Heebo', Georgia, serif;
  /* Elegant serif for headings */
  --font-sans: 'Montserrat', 'Heebo', sans-serif;
  /* Clean geometric sans for UI */
  --font-body: 'Lato', 'Heebo', sans-serif;
  /* Readable body text */

  /* Shadows - Tactile Depth */
  --shadow-sm: 0 2px 4px rgba(44, 62, 80, 0.1);
  /* Subtle lift */
  --shadow-md: 0 4px 8px rgba(44, 62, 80, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
  /* Pressed paper effect */
  --shadow-lg: 0 8px 16px rgba(44, 62, 80, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);
  /* Lifted card */
  --shadow-book: 5px 5px 15px rgba(0, 0, 0, 0.2), 2px 10px 25px rgba(0, 0, 0, 0.1);
  /* 3D book effect */
  --shadow-hover: 0 6px 20px rgba(44, 62, 80, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
  /* Hover lift */

  /* Border Radius - Minimal, Sharp */
  --radius-sm: 2px;
  /* Subtle rounding */
  --radius-md: 4px;
  /* Standard rounding */
  --radius-lg: 8px;
  /* Large rounding */
  --radius-xl: 12px;
  /* Extra large */

  /* Transitions - Smooth & Natural */
  --transition: all 0.2s ease;
  /* Quick, natural feel */

  /* Paper Texture - Subtle Noise */
  --paper-texture: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZmlsdGVyIGlkPSJub2lzZSI+PGZlVHVyYnVsZW5jZSBiYXNlRnJlcXVlbmN5PSIwLjkiIG51bU9jdGF2ZXM9IjQiIHJlc3VsdD0ibm9pc2UiLz48ZmVDb2xvck1hdHJpeCB0eXBlPSJzYXR1cmF0ZSIgdmFsdWVzPSIwIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI25vaXNlKSIgb3BhY2l0eT0iMC4wMiIvPjwvc3ZnPg==');
  /* Subtle paper grain */

  /* Album / picker thumbnail sizing */
  --album-tile-size: 120px;

  /* Page preview zoom (1 = 100%) */
  --page-preview-zoom: 1;
}

/* =====================================================
   TEMPLATE GALLERY - PAPIER STYLE
   ===================================================== */

.template-gallery-view {
  min-height: 100vh;
  background: var(--color-bg);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
}

.editor-view {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
}

.gallery-header {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: 2rem 4rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: var(--shadow-sm);
}

.gallery-header-content h1 {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
  font-weight: 400;
  letter-spacing: -0.02em;
}

.gallery-subtitle {
  color: var(--color-text-light);
  font-size: 1.1rem;
  font-weight: 300;
}

.template-gallery-container {
  flex: 1;
  padding: 4rem;
  max-width: 1400px;
  margin: 0 auto;
  width: 100%;
  overflow-y: auto;
  overflow-x: hidden;
}

.template-gallery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 3rem;
  margin-top: 2rem;
  padding: 1rem;
}

.template-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  overflow: hidden;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-md);
  border: 1px solid var(--color-border);
}

.template-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
  border-color: var(--color-primary);
}

.template-card.template-selected {
  border: 2px solid var(--color-primary);
  box-shadow: var(--shadow-lg);
  transform: translateY(-2px);
}

.template-card.template-selected::after {
  content: '✓ Selected';
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: var(--color-primary);
  color: white;
  padding: 0.4rem 0.8rem;
  border-radius: var(--radius-xl);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  z-index: 10;
}

.template-preview {
  height: 280px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg);
  border-bottom: 1px solid var(--color-border);
}

.template-book-cover {
  width: 120px;
  height: 160px;
  position: relative;
  border-radius: var(--radius-sm);
  border: 2px solid;
  box-shadow: var(--shadow-book);
  transform: perspective(1000px) rotateY(-20deg);
  /* 3D book standing up */
  transition: transform 0.3s ease;
}

.template-card:hover .template-book-cover {
  transform: perspective(1000px) rotateY(-25deg) scale(1.05);
  /* More dramatic on hover */
}

.template-book-spine {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 12px;
  background: var(--color-primary);
  border-radius: 4px 0 0 4px;
}

.template-book-pages {
  position: absolute;
  left: 12px;
  top: 4px;
  bottom: 4px;
  right: 4px;
  background: var(--color-surface);
  border-radius: 0 4px 4px 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.template-decoration {
  position: absolute;
  top: 50%;
  right: 15px;
  transform: translateY(-50%);
  font-size: 2rem;
  opacity: 0.4;
  z-index: 1;
}

.template-info {
  padding: 1.5rem;
}

.template-name {
  font-family: var(--font-serif);
  font-size: 1.25rem;
  color: var(--color-primary);
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.template-category {
  display: inline-block;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--color-text-light);
  margin-bottom: 0.75rem;
  font-weight: 600;
}

.template-description {
  font-size: 0.9rem;
  color: var(--color-text-light);
  line-height: 1.6;
  margin: 0;
}

.btn-icon {
  background: none;
  border: none;
  color: var(--color-primary);
  font-size: 1rem;
  cursor: pointer;
  padding: 0.5rem 1rem;
  border-radius: var(--radius-md);
  transition: var(--transition);
  font-family: var(--font-sans);
}

.btn-icon:hover {
  background: var(--color-bg);
}

/* Reset & Base */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-sans);
  background: var(--color-bg);
  color: var(--color-text-main);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
  overflow-y: auto;
  -webkit-font-smoothing: antialiased;
}

/* =====================================================
   RTL / HEBREW SUPPORT
   ===================================================== */
html[dir="rtl"] body {
  direction: rtl;
}

/* Default: align most text to the right in RTL; keep explicit centers as-is */
html[dir="rtl"] h1,
html[dir="rtl"] h2,
html[dir="rtl"] h3,
html[dir="rtl"] h4,
html[dir="rtl"] h5,
html[dir="rtl"] h6,
html[dir="rtl"] p,
html[dir="rtl"] label,
html[dir="rtl"] input,
html[dir="rtl"] textarea,
html[dir="rtl"] select,
html[dir="rtl"] .setting-label,
html[dir="rtl"] .gallery-title,
html[dir="rtl"] .gallery-subtitle {
  text-align: right;
}

html[dir="rtl"] .btn,
html[dir="rtl"] button {
  font-family: var(--font-sans);
}

/* Ensure dropdown text doesn't get clipped */
html[dir="rtl"] select,
html[dir="rtl"] input,
html[dir="rtl"] textarea {
  direction: rtl;
}

/* Typography */
h1,
h2,
h3,
h4 {
  font-family: var(--font-serif);
  color: var(--color-primary);
  font-weight: 700;
}

/* App Layout */
#app {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* Header - simplified and elegant */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
  z-index: 10;
}

.header h1 {
  font-size: 1.5rem;
  letter-spacing: -0.02em;
}

.header-right {
  display: flex;
  gap: 1.5rem;
  align-items: center;
}

/* Buttons - Vintage Pressed Paper Effect */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 16px 32px;
  border: 1px solid var(--color-primary);
  border-radius: var(--radius-sm);
  font-family: var(--font-sans);
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-transform: uppercase;
  letter-spacing: 1px;
  position: relative;
  box-shadow: 2px 2px 0 var(--color-primary);
  margin: 0 4px;
  /* Pressed paper effect */
}

/* Global Input Styling for Better Readability */
input,
select,
textarea {
  font-size: 1.1rem !important;
  padding: 12px 16px !important;
  border-radius: var(--radius-sm);
  border: 1px solid #ccc;
  box-sizing: border-box;
  /* Ensure padding doesn't add to width */
}

input[type="text"],
input[type="number"],
select {
  height: 52px !important;
  /* Force taller inputs */
}

/* Specific override for Photo Picker buttons to ensure they look big */
.btn-photo-picker {
  height: auto !important;
  min-height: 52px;
  padding: 16px 24px !important;
  font-size: 1.1rem !important;
}

.btn:active {
  transform: translate(2px, 2px);
  box-shadow: none;
  /* Pressed down effect */
}

.btn-primary {
  background: var(--color-primary);
  color: var(--color-bg);
  border-color: var(--color-primary);
}

.btn-primary:hover {
  background: #1a2a24;
  transform: translateY(-1px);
  box-shadow: 3px 3px 0 var(--color-primary);
}

.btn-secondary {
  background: transparent;
  color: var(--color-primary);
  border-color: var(--color-primary);
}

/* Fix: Ensure readability in settings panels regardless of theme */
.editor-settings-panel .btn-secondary,
.settings-panel .btn-secondary {
  color: #1a1a1a !important;
  /* Always dark text */
  border-color: #ccc !important;
}

.editor-settings-panel .btn-secondary:hover,
.settings-panel .btn-secondary:hover {
  background: #f0f0f0 !important;
  color: #000 !important;
  border-color: #999 !important;
}

.btn-secondary:hover {
  background: var(--color-bg-alt);
  transform: translateY(-1px);
  box-shadow: 3px 3px 0 var(--color-primary);
}

.btn-accent {
  background: var(--color-secondary);
  color: white;
}

.btn-accent:hover {
  background: #BFA030;
  transform: translateY(-1px);
}

.btn-small {
  padding: 0.4rem 0.8rem;
  font-size: 0.75rem;
  border-radius: var(--radius-sm);
  text-transform: none;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Main Container */
.main-container {
  display: flex;
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
}

/* Sidebar */
.sidebar {
  width: 420px;
  background: var(--color-bg-alt);
  /* Aged ledger background */
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: row;
  overflow-y: auto;
  overflow-x: hidden;
  z-index: 5;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
  /* Subtle depth */
}

.sidebar-tabs {
  display: flex;
  flex-direction: column;
  padding: 1.5rem 0.75rem;
  width: 140px;
  border-right: 2px solid var(--color-bg);
  background: var(--color-bg-alt);
  flex-shrink: 0;
}

.tab {
  padding: 1.2rem 1rem;
  background: transparent;
  border: none;
  cursor: pointer;
  font-family: var(--font-sans);
  font-weight: 600;
  font-size: 0.95rem;
  color: var(--color-text-light);
  border-right: 3px solid transparent;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  text-align: left;
  margin-bottom: 0.5rem;
  border-radius: var(--radius-sm);
}

.tab:hover {
  color: var(--color-primary);
  background: var(--color-bg);
}

.tab.active {
  color: var(--color-primary);
  border-right-color: var(--color-primary);
  background: var(--color-bg);
}

.tab-content {
  display: none;
  flex: 1;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
  background: var(--color-bg);
  /* Slight contrast for content area */
  padding: 1.5rem;
  font-size: 1.05rem;
}

.tab-content.active {
  display: flex;
}

.tab-content .btn {
  font-size: 1rem;
  padding: 0.9rem 1.5rem;
}

.tab-content input,
.tab-content select,
.tab-content textarea {
  font-size: 1rem;
  padding: 0.75rem 1rem;
}

.tab-content label {
  font-size: 0.9rem;
}

/* Selected Photos */
.selected-actions {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  overflow: visible;
}

.zoom-control {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.35rem 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  box-shadow: var(--shadow-sm);
  max-width: 100%;
  flex: 1 1 220px;
}

.selected-actions .zoom-control {
  margin-right: auto;
  /* push Clear/Shuffle to the right */
}

.zoom-control-compact {
  padding: 0.25rem 0.4rem;
  box-shadow: none;
}

.zoom-icon {
  font-size: 1rem;
  line-height: 1;
}

.zoom-control input[type="range"] {
  width: min(240px, 100%);
  flex: 1 1 auto;
  min-width: 140px;
}

.zoom-control-compact input[type="range"] {
  width: 120px;
}

.zoom-label {
  font-size: 0.85rem;
  color: var(--color-text-light);
  min-width: 48px;
  text-align: right;
  flex: 0 0 auto;
}

.selected-photos-list {
  /* Collapsed “selected strip” (doesn't grow endlessly) */
  display: flex;
  gap: 0.5rem;
  overflow: hidden;
  padding: 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  box-shadow: var(--shadow-sm);
  min-height: 60px;
  align-items: center;
}

.selected-photos-footer {
  display: flex;
  justify-content: flex-end;
  margin-top: 0.75rem;
}

.selected-strip-item {
  width: 56px;
  height: 56px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  background: #fff;
  border: 1px solid var(--color-border);
  flex: 0 0 auto;
}

.selected-strip-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.selected-strip-item .thumbnail-placeholder {
  border: none;
  border-radius: 0;
}

.selected-strip-more {
  width: 56px;
  height: 56px;
  border-radius: var(--radius-sm);
  border: 1px dashed var(--color-border);
  background: var(--color-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: var(--color-text-light);
  flex: 0 0 auto;
}

.selected-photos-modal-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--album-tile-size), 1fr));
  gap: 1rem;
  overflow-y: auto;
  padding: 1rem 0;
  max-height: 60vh;
}

.selected-photos-modal-grid .selected-photo-item {
  aspect-ratio: 1;
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
  box-shadow: var(--shadow-sm);
  background: #fff;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  z-index: 1;
}

.selected-photos-modal-grid .selected-photo-item:hover {
  transform: scale(1.25);
  box-shadow: var(--shadow-lg);
  z-index: 100;
}

.selected-photos-modal-grid .selected-photo-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.page-template-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 1rem;
  overflow-y: auto;
  max-height: 65vh;
  padding: 1rem 0;
}

.page-template-card {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  background: var(--color-surface);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  overflow: hidden;
  transition: var(--transition);
}

.page-template-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
  border-color: var(--color-primary);
}

.page-template-card.active {
  border: 2px solid var(--color-primary);
  box-shadow: var(--shadow-md);
}

.page-template-preview {
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-bottom: 1px solid var(--color-border);
}

.page-template-mini-book {
  width: 96px;
  height: 128px;
  border: 2px solid;
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-book);
  transform: perspective(900px) rotateY(-18deg);
  position: relative;
}

.page-template-mini-spine {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 10px;
  border-radius: 4px 0 0 4px;
}

.page-template-mini-pages {
  position: absolute;
  left: 10px;
  top: 4px;
  bottom: 4px;
  right: 4px;
  border-radius: 0 4px 4px 0;
  border: 1px solid rgba(0, 0, 0, 0.08);
}

.page-template-meta {
  padding: 0.85rem 0.9rem;
}

.page-template-name {
  font-family: var(--font-serif);
  font-weight: 700;
  font-size: 1rem;
  color: var(--color-primary);
  margin: 0 0 0.2rem 0;
}

.page-template-desc {
  font-size: 0.85rem;
  color: var(--color-text-light);
  margin: 0;
  line-height: 1.4;
}

.selected-photo-item {
  aspect-ratio: 1;
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
  box-shadow: var(--shadow-sm);
  background: #fff;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  z-index: 1;
}

.selected-photo-item:hover {
  transform: scale(1.25);
  box-shadow: var(--shadow-lg);
  z-index: 100;
}

.selected-photo-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumbnail-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-alt);
  color: var(--color-text-light);
  border: 1px dashed var(--color-border);
  border-radius: var(--radius-sm);
  font-weight: 600;
  user-select: none;
}

.remove-btn {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 20px;
  height: 20px;
  background: white;
  color: var(--color-error);
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  font-size: 14px;
  line-height: 1;
}

/* Editor Area - The Canvas */
.editor {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #E0Dbd0;
  /* Darker backdrop for the book to pop - vintage desk */
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
  align-items: center;
  justify-content: center;
  padding: 40px;
}

/* Toolbar/Settings Panel */
.settings-panel {
  background: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: 1.25rem 2rem;
  display: flex;
  align-items: center;
  gap: 2rem;
  box-shadow: var(--shadow-sm);
  flex-wrap: wrap;
}

/* Hide album/print configuration toolbar in the editor.
   Configuration is collected only when clicking "Generate Book". */
.album-config-toolbar {
  display: none !important;
}

.setting-group {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  min-width: fit-content;
}

.setting-group label {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-text-light);
  letter-spacing: 0.05em;
}

input[type="text"],
input[type="number"],
select,
textarea {
  padding: 0.6rem 0.9rem;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-sans);
  font-size: 0.9rem;
  /* Always use dark text for inputs - ensures readability regardless of template */
  color: #1e293b !important;
  background: white;
  transition: all 0.2s;
  box-shadow: 1px 1px 0 var(--color-border);
}

input[type="text"]:focus,
input[type="number"]:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 2px 2px 0 var(--color-primary);
  transform: translateY(-1px);
}

input[type="color"] {
  width: 50px;
  height: 40px;
  border: 2px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 1px 1px 0 var(--color-border);
}

input[type="color"]:hover {
  border-color: var(--color-primary);
  box-shadow: 2px 2px 0 var(--color-primary);
  transform: translateY(-1px);
}

input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: var(--color-primary);
}

/* Editor Centered Canvas */
.editor-content {
  flex: 1;
  display: none;
  overflow-y: auto;
  overflow-x: hidden;
  align-items: center;
  /* Center horizontally */
  justify-content: flex-start;
  /* Start from top to prevent overlap */
  padding: 2rem;
  padding-top: 1rem;
  /* Less top padding since tabs have margin-bottom */
  flex-direction: column;
}

.editor-content.active {
  display: flex;
}

/* Allow 3D previews to extend without being clipped */
#pages-editor,
#cover-editor,
#backcover-editor {
  overflow-x: visible;
}

/* Cover & Page Previews - Vintage Book Effect */
.cover-preview,
.page-preview {
  background: white;
  box-shadow: var(--shadow-book);
  /* 3D book shadow */
  width: 800px;
  /* Base width */
  height: 600px;
  /* Base height */
  margin: 20px auto;
  position: relative;
  transform-style: preserve-3d;
  border: 1px solid #ddd;
  transition: transform 0.3s ease;
  /* Specific paper texture */
  background-image: linear-gradient(#fdfbf7 0%, #fff 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  /* Center content within page */
  justify-self: center;
  flex-shrink: 0;
  /* Prevent shrinking */
}

#pagePreview {
  transform: scale(var(--page-preview-zoom));
  transform-origin: top center;
}

/* The 3D spread uses its own transforms; don't scale the entire preview element
   (it can create large empty areas due to transform/perspective composition). */
#pagePreview.is-book-spread {
  transform: none !important;
}

/* ============================================
   3D BOOK SPREAD PREVIEW (Album editor)
   ============================================ */

.page-preview.is-book-spread {
  /* Wider than a single page so we can show a spread */
  width: 1400px;
  padding: 0;
  overflow: visible;
  background: transparent !important;
  background-image: none !important;
  /* Ensure the 3D book isn't affected by the base flex layout */
  display: block;
  position: relative;
  margin: 0 auto;
  transform: scale(1.1);
  transform-origin: center center;
}

/* Prevent any overlay on hover */
.page-preview.is-book-spread:hover {
  background: transparent !important;
  background-image: none !important;
}

.page-preview.is-book-spread>.book3d {
  position: absolute;
  inset: 0;
}

.book3d {
  --book-thickness: 24px;
  /* set by JS */
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  perspective: 1200px;
}

.book3d-stage {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  /* subtle desk-angle */
  transform: rotateX(3deg) rotateY(0deg);
}

/* In the pages editor spread preview, the subtle 3D tilt can visually push the
   album down and make the top appear “cut off” (big white band). Keep the 3D
   geometry but remove the tilt for a true full-height preview. */
.page-preview.is-book-spread .book3d-stage {
  transform: none;
}

.book3d-body {
  position: absolute;
  inset: 0;
  border-radius: 10px;
  background: transparent;
  transform-style: preserve-3d;
}

.book3d-spine,
.book3d-foreedge,
.book3d-bottom {
  position: absolute;
  pointer-events: none;
  border-radius: 10px;
}

/* left spine */
.book3d-spine {
  left: 8px;
  top: 10px;
  bottom: 10px;
  width: var(--book-thickness);
  background: linear-gradient(180deg, rgba(30, 41, 59, 0.35), rgba(30, 41, 59, 0.10));
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.16);
}

/* right page block */
.book3d-foreedge {
  right: 8px;
  top: 10px;
  bottom: 10px;
  width: var(--book-thickness);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.90), rgba(238, 238, 238, 0.85));
  border: 1px solid rgba(0, 0, 0, 0.06);
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.12);
}

/* bottom thickness hint */
.book3d-bottom {
  left: 18px;
  right: 18px;
  bottom: calc(var(--book-thickness) * -0.28);
  height: var(--book-thickness);
  background: linear-gradient(90deg, rgba(0, 0, 0, 0.10), rgba(0, 0, 0, 0.03) 40%, rgba(0, 0, 0, 0.08));
  filter: blur(0.2px);
  opacity: 0.65;
}

.book3d-spread {
  position: absolute;
  top: 10px;
  bottom: 10px;
  left: calc(var(--book-thickness) + 16px);
  right: calc(var(--book-thickness) + 16px);
  display: flex;
  align-items: stretch;
  gap: 0;
  border-radius: 10px;
  overflow: hidden;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0.35));
  box-shadow: 0 18px 55px rgba(0, 0, 0, 0.22);
}

.book3d-gutter {
  width: 18px;
  background: linear-gradient(90deg, rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.03), rgba(0, 0, 0, 0.15));
  box-shadow: inset 0 0 16px rgba(0, 0, 0, 0.25);
  flex: 0 0 auto;
}

.book3d-page {
  flex: 1 1 0;
  position: relative;
  height: 100%;
  display: block;
  overflow: hidden;
  background: #fff;
}

/* The regular page layout grid was tuned for a full 800x600 page.
   In a spread, each side is narrower, so tighten padding to avoid
   the left page feeling "empty". */
.book3d-page .layout-grid {
  position: absolute;
  inset: 0;
  padding: 2rem;
  gap: 16px;
  box-sizing: border-box;
  /* If a layout is missing explicit rows, still fill the page */
  grid-auto-rows: 1fr;
}

.book3d-page .layout-slot {
  min-height: 0;
}

.book3d-page .page-caption {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 10px;
  text-align: center;
  font-style: italic;
  font-size: 12px;
  pointer-events: none;
  z-index: 6;
  padding: 0 12px;
}

.book3d-page.is-active {
  outline: 3px solid rgba(44, 62, 80, 0.18);
  outline-offset: -3px;
}

.book3d-page:not(.is-active) {
  filter: saturate(0.98) contrast(0.98);
}

.book3d-page:not(.is-active) .layout-grid,
.book3d-page:not(.is-active) .layout-slot,
.book3d-page:not(.is-active) .edit-photo-btn {
  pointer-events: none;
}

.book3d-page-activate {
  position: absolute;
  inset: 0;
  z-index: 5;
  background: transparent;
  border: none;
  cursor: pointer;
}

.book3d-page.is-active .book3d-page-activate {
  display: none;
}

.book3d-progress {
  position: absolute;
  left: 50%;
  bottom: 10px;
  transform: translateX(-50%);
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.85);
  border: 1px solid rgba(0, 0, 0, 0.08);
  color: rgba(30, 41, 59, 0.85);
  font-size: 12px;
  box-shadow: 0 10px 18px rgba(0, 0, 0, 0.10);
  z-index: 6;
  user-select: none;
  pointer-events: none;
}

/* Flip layer (animation overlay) */
.book3d-flip-layer {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 7;
  transform-style: preserve-3d;
}

.book3d-sheet {
  position: absolute;
  top: 0;
  bottom: 0;
  width: calc((100% - 18px) / 2);
  transform-style: preserve-3d;
  transition: transform 520ms cubic-bezier(0.2, 0.8, 0.2, 1);
}

.book3d-sheet.is-next {
  left: calc((100% + 18px) / 2);
  transform-origin: left center;
  transform: rotateY(0deg);
}

.book3d-sheet.is-prev {
  left: 0;
  transform-origin: right center;
  transform: rotateY(0deg);
}

.book3d-sheet.is-next.is-flipping {
  transform: rotateY(-180deg);
}

.book3d-sheet.is-prev.is-flipping {
  transform: rotateY(180deg);
}

.book3d-sheet-face {
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  overflow: hidden;
  border-radius: 10px;
  box-shadow: 0 18px 35px rgba(0, 0, 0, 0.18);
}

.book3d-sheet-face.back {
  transform: rotateY(180deg);
}

.book3d-sheet-face .layout-grid {
  pointer-events: none;
}

@media (max-width: 1100px) {
  .page-preview.is-book-spread {
    width: 980px;
  }
}

@media (max-width: 980px) {
  .page-preview.is-book-spread {
    width: 900px;
  }
}

/* ============================================
   3D COVER PREVIEW (Cover + Back cover tabs)
   ============================================ */

.cover-preview.is-cover-3d {
  padding: 0;
  overflow: visible;
  /* The 3D face holds the cover artwork/background. */
  background: transparent;
  background-image: none;
}

.book3d-cover-root {
  --book-thickness: 24px;
  /* set by JS */
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  perspective: 1200px;
}

.book3d-cover-stage {
  position: absolute;
  inset: 0;
  transform-style: preserve-3d;
  transform: rotateX(3deg) rotateY(-6deg);
}

.book3d-cover-root.is-back .book3d-cover-stage {
  transform: rotateX(3deg) rotateY(6deg);
}

/* Our old crease pseudo-element doesn't belong on the 3D previews */
.page-preview.is-book-spread::before,
.page-preview.is-book-spread:hover::before,
.cover-preview.is-cover-3d::before,
.cover-preview.is-cover-3d::after {
  content: none !important;
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

.book3d-cover-face::after {
  content: '';
  position: absolute;
  top: 1.75rem;
  left: 1.75rem;
  right: 1.75rem;
  bottom: 1.75rem;
  border: 2px solid currentColor;
  opacity: 0.12;
  pointer-events: none;
}

/* Restore the original cover layout (padding/spacing) inside the 3D face */
.book3d-cover-inner {
  justify-content: space-between;
  padding: 4rem;
  text-align: center;
  overflow: hidden;
}

.book3d-cover-face {
  position: absolute;
  top: 10px;
  bottom: 10px;
  left: calc(var(--book-thickness) + 16px);
  right: calc(var(--book-thickness) + 16px);
  border-radius: 10px;
  overflow: hidden;
  background: #fff;
  box-shadow: 0 18px 55px rgba(0, 0, 0, 0.22);
  display: flex;
}

.book3d-cover-inner {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.book3d-cover-spine,
.book3d-cover-foreedge,
.book3d-cover-bottom {
  position: absolute;
  pointer-events: none;
  border-radius: 10px;
}

.book3d-cover-spine {
  left: 8px;
  top: 10px;
  bottom: 10px;
  width: var(--book-thickness);
  background: linear-gradient(180deg, rgba(30, 41, 59, 0.35), rgba(30, 41, 59, 0.10));
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.16);
}

.book3d-cover-foreedge {
  right: 8px;
  top: 10px;
  bottom: 10px;
  width: var(--book-thickness);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.90), rgba(238, 238, 238, 0.85));
  border: 1px solid rgba(0, 0, 0, 0.06);
  box-shadow: 0 10px 28px rgba(0, 0, 0, 0.12);
}

.book3d-cover-bottom {
  left: 18px;
  right: 18px;
  bottom: calc(var(--book-thickness) * -0.28);
  height: var(--book-thickness);
  background: linear-gradient(90deg, rgba(0, 0, 0, 0.10), rgba(0, 0, 0, 0.03) 40%, rgba(0, 0, 0, 0.08));
  filter: blur(0.2px);
  opacity: 0.65;
}

.book3d-cover-root.is-back .book3d-cover-spine {
  left: auto;
  right: 8px;
}

.book3d-cover-root.is-back .book3d-cover-foreedge {
  right: auto;
  left: 8px;
}

.book3d-cover-root.is-back .book3d-cover-face {
  left: calc(var(--book-thickness) + 16px);
  right: calc(var(--book-thickness) + 16px);
}

/* Book crease effect - vintage binding */
.page-preview::before,
.cover-preview::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 40px;
  background: linear-gradient(to right, rgba(0, 0, 0, 0.1), transparent);
  z-index: 10;
  pointer-events: none;
}

/* Disable ::before for 3D spread view - this was causing diagonal overlay bug */
.page-preview.is-book-spread::before,
.page-preview.is-book-spread:hover::before {
  content: none !important;
  display: none !important;
}

/* Cover Specifics - Highly Designed */
.cover-preview {
  justify-content: space-between;
  padding: 4rem;
  text-align: center;
  position: relative;
  overflow: hidden;
}

/* Cover decorative elements */
.cover-preview::after {
  content: '';
  position: absolute;
  top: 2rem;
  left: 2rem;
  right: 2rem;
  bottom: 2rem;
  border: 2px solid currentColor;
  opacity: 0.15;
  pointer-events: none;
  z-index: 1;
}

.cover-photo-placeholder {
  width: 100%;
  height: 60%;
  background: linear-gradient(135deg, #F5F5F5 0%, #E8E8E8 100%);
  border: 3px solid rgba(0, 0, 0, 0.1);
  border-radius: var(--radius-sm);
  margin-bottom: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #999;
  font-size: 0.9rem;
  cursor: pointer;
  overflow: hidden;
  position: relative;
  z-index: 2;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.cover-photo-placeholder:hover {
  background: linear-gradient(135deg, #EAEAEA 0%, #DADADA 100%);
  border-color: var(--color-primary);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}

.cover-photo-placeholder img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.cover-title {
  font-family: var(--font-serif);
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--color-primary);
  margin-bottom: 0.75rem;
  line-height: 1.2;
  letter-spacing: -0.02em;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  position: relative;
  z-index: 2;
}

.cover-subtitle {
  font-family: var(--font-sans);
  font-size: 1rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--color-text-light);
  opacity: 0.8;
  position: relative;
  z-index: 2;
}

/* Cover settings layout */
.cover-settings {
  display: flex;
  gap: 3rem;
  padding: 2rem;
  max-width: 1600px;
  margin: 0 auto;
  width: 100%;
  align-items: flex-start;
}

/* Page Layout Grid */
.layout-grid {
  display: grid;
  width: 100%;
  height: 100%;
  gap: 20px;
  padding: 3rem;
  /* Inner page margin */
  background: transparent;
  /* Prevent grid items from overflowing/overlapping due to intrinsic min-size */
  grid-auto-rows: minmax(0, 1fr);
}

.layout-slot {
  /* Let the page background (template/bg color) show through */
  background: transparent;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  transition: opacity 0.2s, border 0.2s, box-shadow 0.2s;
  border: 2px solid transparent;
  /* Critical for CSS grid: allow the slot to shrink within its cell */
  min-width: 0;
  min-height: 0;
}

/* Keep a subtle surface for empty slots only */
.layout-slot:not(.has-photo) {
  background: rgba(255, 255, 255, 0.25);
}

.layout-slot:hover {
  opacity: 0.9;
  border-color: var(--color-primary);
}

.layout-slot.selected {
  border-color: var(--color-secondary);
  box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.3);
}

.layout-slot.has-photo {
  cursor: grab;
}

.layout-slot.has-photo:active {
  cursor: grabbing;
}

.layout-slot.drag-over {
  border: 2px dashed var(--color-secondary);
  background: rgba(212, 175, 55, 0.1);
}

.layout-slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  /* Fill the slot like a real photo book (cropping if needed) */
  pointer-events: none;
}

/* Page Decorations */
.page-decorations {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}

.page-decorations>div {
  position: absolute;
  font-size: 2rem;
  opacity: 0.15;
  transition: opacity 0.3s ease;
}

.page-preview:hover .page-decorations>div {
  opacity: 0.25;
}

.layout-slot:empty::after {
  content: '+';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 2rem;
  color: #DDD;
}

.slot-number {
  position: absolute;
  top: 5px;
  left: 5px;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.75rem;
  font-weight: 600;
}

.alignment-indicator {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(30, 57, 50, 0.8);
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.75rem;
}

.alignment-controls {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.btn-alignment {
  flex: 1;
  padding: 0.75rem 1rem;
  border: 2px solid var(--color-border);
  background: white;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 1.2rem;
  transition: var(--transition);
  min-width: 50px;
  box-shadow: 1px 1px 0 var(--color-border);
}

.btn-alignment:hover {
  border-color: var(--color-primary);
  background: var(--color-bg);
  transform: translateY(-1px);
  box-shadow: 2px 2px 0 var(--color-primary);
}

.btn-alignment.active {
  border-color: var(--color-secondary);
  background: var(--color-secondary);
  color: white;
  box-shadow: none;
  transform: translateY(1px);
}

/* Login Screen - Full Screen Vintage */
#loginScreen {
  background: var(--color-bg) !important;
  /* Cream paper background */
  font-family: var(--font-body);
}

#loginScreen h1 {
  font-family: var(--font-serif) !important;
  color: var(--color-primary) !important;
  letter-spacing: -0.5px;
}

/* Progress Bar - Vintage Fountain Pen Effect */
.progress-bar-container {
  background: #E0E0E0;
  border-radius: 4px;
  overflow: hidden;
  margin-top: 1rem;
}

/* Resize handles for photos (scoped to layout slots to avoid clashing with the sidebar resize divider) */
.layout-slot .resize-handle {
  position: absolute;
  background: var(--color-secondary);
  border: 2px solid white;
  border-radius: 50%;
  width: 12px;
  height: 12px;
  z-index: 10;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s;
}

.layout-slot.has-photo:hover .resize-handle {
  opacity: 1;
}

.layout-slot .resize-handle:hover {
  background: var(--color-primary);
  transform: scale(1.2);
}

.layout-slot .resize-nw {
  top: -6px;
  left: -6px;
  cursor: nw-resize;
}

.layout-slot .resize-ne {
  top: -6px;
  right: -6px;
  cursor: ne-resize;
}

.layout-slot .resize-sw {
  bottom: -6px;
  left: -6px;
  cursor: sw-resize;
}

.layout-slot .resize-se {
  bottom: -6px;
  right: -6px;
  cursor: se-resize;
}

.layout-slot .resize-n {
  top: -6px;
  left: 50%;
  transform: translateX(-50%);
  cursor: n-resize;
}

.layout-slot .resize-s {
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  cursor: s-resize;
}

.layout-slot .resize-e {
  right: -6px;
  top: 50%;
  transform: translateY(-50%);
  cursor: e-resize;
}

.layout-slot .resize-w {
  left: -6px;
  top: 50%;
  transform: translateY(-50%);
  cursor: w-resize;
}

/* Editor Controls (Right Panel specific for controls when needed, or below) */
/* For this redesign, let's keep controls below or sidebar? 
   Let's make a floating controls panel or sidebar. 
   Currently it's structure is mixed. Let's create a "Properties Panel" style. */

.editor-tabs {
  display: flex;
  justify-content: center;
  gap: 1rem;
  background: white;
  padding: 0.75rem 1rem;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-sm);
  z-index: 10;
  width: fit-content;
  margin: 2rem auto 1.5rem auto;
  /* Increased top margin for separation */
  /* Remove margin-top, add margin-bottom */
}

.editor-tab {
  padding: 0.5rem 1rem;
  border-radius: var(--radius-xl);
  border: none;
  background: transparent;
  cursor: pointer;
  font-family: var(--font-sans);
  font-weight: 600;
  font-size: 0.8rem;
  color: var(--color-text-light);
  transition: all 0.2s;
}

.editor-tab.active {
  background: var(--color-primary);
  color: white;
}

/* Page Editor Area */
.page-editor-area {
  position: relative;
  flex: 1;
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  justify-content: center;
  gap: 2rem;
  width: 100%;
  max-width: 1600px;
  padding-bottom: 5rem;
  /* Space for fixed navigator */
}

/* In the pages editor, keep preview + controls side-by-side */
.page-editor-area .page-preview {
  margin: 20px 0;
  /* override auto-centering */
}

/* ============================================
   Auto-Arrange CTA (Pages editor)
   ============================================ */

.auto-arrange-cta {
  width: 100%;
  max-width: 1600px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  padding: 10px 14px;
  margin: 6px auto 8px;
  border-radius: var(--radius-lg);
  background: rgba(255, 255, 255, 0.85);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
}

.btn-auto-arrange {
  font-size: 0.95rem;
  font-weight: 800;
  padding: 0.95rem 1.15rem;
  letter-spacing: 0.02em;
}

.btn-auto-arrange .auto-arrange-icon {
  margin-right: 8px;
  font-size: 1.1rem;
  line-height: 1;
}

.auto-arrange-sub {
  color: var(--color-text-light);
  font-size: 0.85rem;
}

@media (max-width: 900px) {
  .auto-arrange-cta {
    flex-direction: column;
    align-items: stretch;
    text-align: center;
  }

  .auto-arrange-sub {
    padding-bottom: 4px;
  }
}

/* Navigation for Pages */
.page-navigator {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  background: white;
  padding: 1rem 1.5rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  position: fixed;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
}

.page-thumbnails {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
  overflow-y: visible;
  max-width: 400px;
  padding: 0.5rem 0.5rem 0.75rem;
  position: relative;
}

.page-thumbnail {
  width: 40px;
  height: 40px;
  background: white;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 600;
  flex: 0 0 auto;
  position: relative;
  z-index: 0;
  transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease, background-color 160ms ease, color 160ms ease, font-size 160ms ease;
  transform-origin: center bottom;
  will-change: transform;
}

.page-thumbnail:hover {
  transform: scale(1.35);
  z-index: 5;
  font-size: 0.95rem;
  font-weight: 800;
  border-color: var(--color-primary);
  background: #fff;
  color: var(--color-primary);
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
}

.page-thumbnail.active:hover {
  transform: scale(1.4);
}

.page-thumbnail.active {
  border-color: var(--color-primary);
  background: var(--color-bg);
  box-shadow: 0 0 0 2px var(--color-primary);
}

/* =====================================================
   PAGES OVERVIEW (BIGGER MINI PREVIEWS + STATUS)
   ===================================================== */
.pages-overview-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
  padding: 10px;
}

@media (max-width: 900px) {
  .pages-overview-grid {
    grid-template-columns: 1fr;
  }
}

.page-thumbnail-card {
  background: #fff;
  border: 2px solid var(--color-border);
  border-radius: 14px;
  padding: 10px;
  cursor: pointer;
  transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
}

.page-thumbnail-card:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
}

.page-thumbnail-card.active {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.25);
}

.page-thumbnail-card.status-empty { border-color: #cbd5e1; }
.page-thumbnail-card.status-partial { border-color: #f59e0b; }
.page-thumbnail-card.status-complete { border-color: #22c55e; }

.page-thumb-surface {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 12px;
  overflow: hidden;
  background: #f8fafc;
  border: 1px solid rgba(0, 0, 0, 0.08);
}

.page-thumb-slots {
  position: absolute;
  inset: 0;
  padding: 8px;
  display: grid;
  gap: 6px;
  pointer-events: none;
}

.page-thumb-slots.slots-1 { grid-template-columns: 1fr; grid-template-rows: 1fr; }
.page-thumb-slots.slots-2 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr; }
.page-thumb-slots.slots-3 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
.page-thumb-slots.slots-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }

.page-thumb-slot {
  background: rgba(255, 255, 255, 0.55);
  border: 1px dashed rgba(0, 0, 0, 0.18);
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.page-thumb-slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.page-thumb-slot.is-text {
  background: rgba(255, 255, 255, 0.75);
  border-style: solid;
  border-color: rgba(0, 0, 0, 0.12);
  font-weight: 800;
  font-size: 14px;
  color: #0f172a;
}

.page-thumb-meta {
  margin-top: 8px;
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 10px;
}

.page-thumb-num {
  font-size: 12px;
  font-weight: 700;
  color: #0f172a;
}

.page-thumb-status {
  font-size: 11px;
  font-weight: 700;
  color: #475569;
}

.page-thumb-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  font-size: 10px;
  font-weight: 800;
  padding: 4px 8px;
  border-radius: 999px;
  background: rgba(15, 23, 42, 0.75);
  color: #fff;
  pointer-events: none;
}

.page-thumbnail-card.status-empty .page-thumb-badge { background: rgba(100, 116, 139, 0.85); }
.page-thumbnail-card.status-partial .page-thumb-badge { background: rgba(245, 158, 11, 0.9); }
.page-thumbnail-card.status-complete .page-thumb-badge { background: rgba(34, 197, 94, 0.9); }

/* Photo Selection Popup - Animated */
.photo-selection-popup {
  position: fixed;
  inset: 0;
  background: rgba(30, 57, 50, 0.7);
  backdrop-filter: blur(4px);
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.photo-selection-popup.active {
  opacity: 1;
  pointer-events: all;
}

.photo-selection-popup-content {
  background: white;
  padding: 3rem 2.5rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-width: 500px;
  width: 90%;
  text-align: center;
  transform: scale(0.9) translateY(20px);
  transition: transform 0.3s ease;
}

.photo-selection-popup.active .photo-selection-popup-content {
  transform: scale(1) translateY(0);
}

.photo-selection-popup-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {

  0%,
  100% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.1);
  }
}

.photo-selection-popup-content h2 {
  font-family: var(--font-serif);
  color: var(--color-primary);
  margin-bottom: 0.75rem;
  font-size: 1.75rem;
}

.photo-selection-popup-content p {
  color: var(--color-text-light);
  margin-bottom: 2rem;
  font-size: 1rem;
  line-height: 1.6;
}

.photo-selection-popup-actions {
  display: flex;
  gap: 1rem;
  justify-content: center;
}

/* Modals */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(30, 57, 50, 0.6);
  /* Primary color dim */
  backdrop-filter: blur(2px);
  z-index: 20000 !important;
  align-items: center;
  justify-content: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-width: 600px;
  max-height: 80vh;
  width: 90%;
  text-align: center;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
}

.modal-content.modal-large {
  max-width: 900px;
  text-align: left;
}

.design-inspiration-content {
  overflow-y: auto;
  max-height: 60vh;
  padding: 1rem 0;
}



.modal-content h3 {
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.modal-header-actions {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.close-btn {
  border: none;
  background: transparent;
  font-size: 1.75rem;
  line-height: 1;
  cursor: pointer;
  color: var(--color-text-light);
  padding: 0.25rem 0.4rem;
  border-radius: var(--radius-sm);
}

.close-btn:hover {
  background: rgba(0, 0, 0, 0.06);
  color: var(--color-text-main);
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-top: 1rem;
}

/* =====================================================
   PROFILE MODAL
   ===================================================== */

.profile-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 0.75rem;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--color-border);
}

.profile-avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  object-fit: cover;
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
}

.profile-name {
  font-weight: 600;
  color: var(--color-text-main);
}

.profile-email {
  color: var(--color-text-light);
  font-size: 0.9rem;
}

.profile-tabs {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.75rem;
  border-bottom: 1px solid var(--color-border);
}

.profile-tab {
  border: 1px solid var(--color-border);
  border-bottom: none;
  background: transparent;
  padding: 0.55rem 0.85rem;
  border-radius: var(--radius-md) var(--radius-md) 0 0;
  cursor: pointer;
  font-family: var(--font-sans);
  color: var(--color-text-light);
}

.profile-tab.active {
  background: var(--color-bg);
  color: var(--color-primary);
  border-color: var(--color-primary);
}

.profile-tab-content {
  display: none;
  padding: 1rem 0 0.25rem;
  overflow-y: auto;
  max-height: 55vh;
}

.profile-tab-content.active {
  display: block;
}

.profile-section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.profile-section-header h4 {
  margin: 0;
  font-size: 1.05rem;
}

.profile-actions-inline {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.profile-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

@media (max-width: 900px) {
  .profile-grid {
    grid-template-columns: 1fr;
  }
}

.profile-card {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: 1rem;
  background: var(--color-bg);
}

.profile-form .control-group {
  margin-bottom: 0.65rem;
}

.profile-form input {
  width: 100%;
}

.projects-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.project-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  padding: 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: white;
  color: #333333;
  /* Explicitly dark text for visibility */
  cursor: pointer;
  transition: var(--transition);
}

.project-item:hover {
  box-shadow: var(--shadow-sm);
  border-color: var(--color-primary);
}

.project-item .project-actions {
  display: inline-flex;
  gap: 0.4rem;
}

.profile-purchases-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.purchase-item {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: 0.75rem;
  background: white;
}

.purchase-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
}

.purchase-meta .purchase-title {
  font-weight: 600;
}

.purchase-meta .purchase-subtitle {
  font-size: 0.85rem;
  color: var(--color-text-light);
  margin-top: 0.25rem;
}

.purchase-badge {
  font-size: 0.75rem;
  padding: 0.2rem 0.5rem;
  border-radius: var(--radius-xl);
  border: 1px solid var(--color-border);
  color: var(--color-text-light);
  background: var(--color-bg);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

/* Photo Picker Grid */
.selected-photos-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--album-tile-size), 1fr));
  gap: 1rem;
  overflow-y: auto;
  flex: 1;
  padding: 1rem 0;
  max-height: 60vh;
}

.selected-photos-grid .photo-item {
  cursor: pointer;
  position: relative;
  overflow: hidden;
  border-radius: var(--radius-sm);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  z-index: 1;
}

.selected-photos-grid .photo-item:hover {
  transform: scale(1.15);
  box-shadow: var(--shadow-lg);
  z-index: 10;
}

.selected-photos-grid img {
  width: 100%;
  aspect-ratio: 1;
  object-fit: cover;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: transform 0.3s ease;
  display: block;
}

.selected-photos-grid .photo-item:hover img {
  transform: scale(1);
}


/* Resize Handle */
.resize-handle {
  width: 1px;
  background: var(--color-border);
  cursor: col-resize;
  position: relative;
  z-index: 10;
}

.resize-handle:hover::after {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  /* Keep the hover hit-area on the editor side (right) so it doesn't sit on top of the album thumbnails */
  left: 0;
  right: -8px;
  background: rgba(0, 0, 0, 0.05);
}

/* Utilities */
.hidden {
  display: none !important;
}

.text-center {
  text-align: center;
}

.mt-1 {
  margin-top: 1rem;
}

.mb-1 {
  margin-bottom: 1rem;
}

/* Grid Utilities for Layouts */
.layout-single {
  grid-template-columns: 1fr;
}

.layout-two-horizontal {
  grid-template-rows: 1fr 1fr;
  grid-template-columns: 1fr;
}

.layout-two-vertical {
  grid-template-columns: 1fr 1fr;
}

.layout-three-left {
  grid-template-columns: 1.6fr 1fr;
  grid-template-rows: 1fr 1fr;
}

.layout-three-left .slot-0 {
  grid-column: 1;
  grid-row: 1 / span 2;
  /* big left */
}

.layout-three-left .slot-1 {
  grid-column: 2;
  grid-row: 1;
}

.layout-three-left .slot-2 {
  grid-column: 2;
  grid-row: 2;
}

.layout-three-right {
  grid-template-columns: 1fr 1.6fr;
  grid-template-rows: 1fr 1fr;
}

.layout-three-right .slot-0 {
  grid-column: 1;
  grid-row: 1;
}

.layout-three-right .slot-1 {
  grid-column: 1;
  grid-row: 2;
}

.layout-three-right .slot-2 {
  grid-column: 2;
  grid-row: 1 / span 2;
  /* big right */
}

.layout-four-grid {
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
}

/* Collage layouts */
.layout-collage-5 {
  grid-template-columns: 1.2fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
}

.layout-collage-5 .slot-0 {
  grid-column: 1 / span 2;
  grid-row: 1 / span 2;
  /* hero */
}

.layout-collage-5 .slot-1 {
  grid-column: 3;
  grid-row: 1;
}

.layout-collage-5 .slot-2 {
  grid-column: 3;
  grid-row: 2;
}

.layout-collage-5 .slot-3 {
  grid-column: 2;
  grid-row: 2;
}

.layout-collage-5 .slot-4 {
  grid-column: 2;
  grid-row: 1;
}

.layout-collage-6 {
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
}

/* Add more complex grids as needed */

/* Theme List Styles */
.theme-list {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

.theme-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.5rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.2s;
  border: 1px solid transparent;
}

.theme-item:hover {
  background: rgba(0, 0, 0, 0.03);
  border-color: var(--color-border);
}

.theme-preview {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  box-shadow: var(--shadow-sm);
}

/* 3D Book Preview */
/* 3D Book Preview - Vintage Standing Book */
.book-3d-preview {
  width: 80px;
  height: 60px;
  perspective: 1000px;
  margin: 0 auto;
  transition: transform 0.5s ease;
  transform: rotateY(-20deg);
  /* Book standing up - vintage library */
}

.book-cover-3d {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.5s ease;
  border-radius: 4px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.theme-item:hover .book-cover-3d {
  transform: perspective(1000px) rotateY(-10deg);
}

.theme-item.active .book-cover-3d {
  transform: perspective(1000px) rotateY(-15deg) scale(1.1);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.book-spine-3d {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 8px;
  transform: translateZ(-2px);
  border-radius: 4px 0 0 4px;
}

.book-pages-3d {
  position: absolute;
  left: 8px;
  top: 2px;
  bottom: 2px;
  right: 2px;
  transform: translateZ(-1px);
  border-radius: 0 4px 4px 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.book-decoration {
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
  font-size: 1.2rem;
  opacity: 0.6;
  z-index: 1;
}

.theme-item.active {
  background: var(--color-accent);
  border-color: var(--color-secondary);
}

.theme-item.active .book-decoration {
  opacity: 1;
  transform: translateY(-50%) scale(1.2);
}

/* Edit button for photos */
.selected-photo-item {
  position: relative;
}

.edit-btn {
  position: absolute;
  top: 5px;
  right: 30px;
  background: var(--color-secondary);
  color: white;
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  opacity: 0;
  transition: opacity 0.2s, transform 0.2s;
  z-index: 2;
}

.selected-photo-item:hover .edit-btn {
  opacity: 1;
}

.edit-btn:hover {
  transform: scale(1.1);
  background: var(--color-primary);
}

/* Edit button for album page photos */
.edit-photo-btn {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: transparent;
  color: var(--color-primary);
  border: none;
  border-radius: 0;
  width: 36px;
  height: 36px;
  padding: 0;
  font-size: 1.2rem;
  line-height: 1;
  cursor: pointer;
  z-index: 10;
  opacity: 0.7;
  transition: opacity 0.2s, transform 0.2s;
  font-weight: 400;
  display: flex;
  align-items: center;
  justify-content: center;
  text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
}

.layout-slot.has-photo:hover .edit-photo-btn {
  opacity: 1;
  transform: scale(1.1);
}

.edit-photo-btn:hover {
  opacity: 1;
  transform: scale(1.15);
}

/* ============================================
   DESIGN EDITOR STYLES
   ============================================ */

.design-editor-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 1rem;
  overflow-y: auto;
}

.design-toolbar {
  margin-bottom: 1rem;
}

.tool-section {
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--color-border);
}

.tool-section:last-child {
  border-bottom: none;
}

.tool-section h4 {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text-main);
  margin-bottom: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tool-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition);
  font-size: 0.85rem;
  font-family: var(--font-sans);
}

.tool-btn:hover {
  background: var(--color-accent);
  border-color: var(--color-secondary);
  transform: translateY(-1px) scale(1.04);
  box-shadow: var(--shadow-md);
}

.tool-btn.active {
  background: var(--color-secondary);
  color: white;
  border-color: var(--color-secondary);
}

.tool-btn span {
  font-size: 1.2rem;
}

.filter-btn {
  padding: 0.6rem 0.8rem;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition);
  font-size: 0.8rem;
  text-align: center;
  font-family: var(--font-sans);
}

.filter-btn:hover {
  background: var(--color-accent);
  border-color: var(--color-secondary);
  transform: translateY(-1px) scale(1.04);
  box-shadow: var(--shadow-md);
}

.filter-btn.active {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}

.design-canvas-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg);
  border-radius: var(--radius-md);
  padding: 1rem;
  min-height: 400px;
}

.canvas-wrapper {
  width: 100%;
  height: 100%;
  min-height: 400px;
  display: flex !important;
  align-items: center;
  justify-content: center;
  background:
    linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
    linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
    linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
  background-size: 20px 20px;
  background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
  position: relative;
  visibility: visible !important;
  opacity: 1 !important;
}

#designCanvas {
  display: block !important;
  visibility: visible !important;
  background: white !important;
  box-shadow: var(--shadow-md);
  max-width: 100%;
  max-height: 100%;
  opacity: 1 !important;
  position: relative;
  z-index: 1;
  transition: transform 0.18s ease, box-shadow 0.18s ease;
}

.design-canvas-wrapper:hover #designCanvas {
  transform: scale(1.04);
  box-shadow: var(--shadow-lg);
}

.text-editor-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  z-index: 10000;
  min-width: 300px;
  max-width: 500px;
  display: none;
}

.text-editor-content {
  padding: 1.5rem;
}

.text-editor-content h4 {
  margin-bottom: 1rem;
  color: var(--color-primary);
}

.text-editor-content .control-group {
  margin-bottom: 1rem;
}

.text-editor-content .control-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  color: var(--color-text-main);
}

.text-editor-content .control-group input[type="text"],
.text-editor-content .control-group input[type="range"],
.text-editor-content .control-group input[type="color"],
.text-editor-content .control-group select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-sans);
}

.text-editor-content .control-group input[type="range"] {
  margin-bottom: 0.5rem;
}

.text-editor-content .btn {
  margin-right: 0.5rem;
  margin-top: 0.5rem;
}

/* Control Groups */
.control-group {
  margin-bottom: 1.5rem;
}

.control-group label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--color-text-main);
  margin-bottom: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.control-group input,
.control-group select,
.control-group textarea {
  /* Always use dark text for inputs - ensures readability regardless of template */
  color: #1e293b !important;
  width: 100%;
}

.inline-controls {
  display: flex;
  gap: 0.5rem;
  /* Reduced gap from 1rem */
  align-items: center;
  flex-wrap: wrap;
  /* Allow wrapping to prevent overflow */
}

.inline-controls input[type="checkbox"] {
  margin-right: 0.25rem;
}

.inline-controls input[type="color"] {
  flex-shrink: 0;
  max-width: 50px;
  /* Limit width */
}

.inline-controls input[type="number"] {
  width: 60px;
  /* Reduced width from 80px */
  flex-shrink: 0;
}

/* Page Controls */
.page-controls {
  background: white;
  border-radius: var(--radius-lg);
  padding: 2rem;
  box-shadow: var(--shadow-sm);
  margin-top: 20px;
  /* match preview vertical rhythm */
  width: 340px;
  flex: 0 0 340px;
  align-self: flex-start;
  position: sticky;
  top: 1rem;
}

.page-controls .control-group {
  margin-bottom: 1.5rem;
}

@media (max-width: 1200px) {
  .page-editor-area {
    flex-direction: column;
    align-items: center;
  }

  .page-controls {
    position: static;
    width: min(800px, 100%);
    flex: 0 0 auto;
  }
}

/* Pages Toolbar */
.pages-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  background: white;
  padding: 1rem 1.5rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  margin-bottom: 1.5rem;
}

.pages-toolbar-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.pages-toolbar-right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.page-indicator {
  font-size: 0.9rem;
  color: var(--color-text-light);
  font-weight: 600;
}

/* Cover and Back Cover Controls */
.cover-controls,
.back-cover-controls {
  flex: 1;
  background: white;
  border-radius: var(--radius-lg);
  padding: 2rem;
  box-shadow: var(--shadow-sm);
}

/* Responsive adjustments for design editor */
@media (max-width: 768px) {

  .tool-controls,
  .filter-controls {
    grid-template-columns: 1fr;
  }

  .design-canvas-container {
    min-height: 300px;
  }

  .cover-settings {
    flex-direction: column;
  }
}

/* Fixed Action Buttons Spacing */
.actions-group-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.actions-group-container .btn {
  margin: 0 !important;
  flex-grow: 1;
}

.actions-group-container .btn-primary {
  width: 100%;
  flex-basis: 100%;
  margin-top: 0.5rem !important;
}

/* Ensure two-column button layout inside Design tab */
#toolControls,
#brushControls,
#filterControls {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 0.5rem;
}

/* Stack controls on very narrow screens */
@media (max-width: 480px) {

  #toolControls,
  #brushControls,
  #filterControls {
    grid-template-columns: 1fr;
  }
}

/* Modal Actions Spacing */
.result-actions {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1.5rem;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 2rem;
  border-top: 1px solid var(--color-border);
  padding-top: 1rem;
}

/* ============================================
   MEMORY DIRECTOR STYLES
   ============================================ */

.memory-director-view {
  min-height: 100vh;
  background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
}

.md-header {
  padding: 14px 24px;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: white;
  position: sticky;
  top: 0;
  z-index: 100;
}

.md-header-left {
  display: flex;
  align-items: center;
  gap: 14px;
}

.md-header-left h1 {
  margin: 0;
  font-size: 18px;
  font-weight: 700;
  color: #1e293b;
  font-family: var(--font-serif);
}

.md-project-badge {
  font-size: 12px;
  color: #64748b;
  background: #f1f5f9;
  padding: 5px 12px;
  border-radius: 20px;
}

.md-header-right {
  display: flex;
  gap: 10px;
  align-items: center;
}

.md-layout {
  display: flex;
  height: calc(100vh - 57px);
}

.md-sidebar {
  background: white;
  padding: 20px;
  overflow-y: auto;
}

.md-sidebar-left {
  width: 300px;
  border-right: 1px solid #e2e8f0;
}

.md-sidebar-right {
  width: 260px;
  border-left: 1px solid #e2e8f0;
}

.md-main {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  background: #f8fafc;
}

.md-sidebar-title {
  margin: 0 0 4px 0;
  font-size: 11px;
  font-weight: 600;
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: var(--font-sans);
}

.md-sidebar-subtitle {
  margin: 0 0 20px 0;
  font-size: 12px;
  color: #94a3b8;
}

.md-chapter-card {
  background: white;
  border: 2px solid #f1f5f9;
  border-radius: 16px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: 12px;
}

.md-chapter-card:hover {
  border-color: #e2e8f0;
  transform: translateY(-1px);
}

.md-chapter-card.active {
  background: linear-gradient(135deg, color-mix(in srgb, var(--chapter-color, #8b5cf6) 8%, white) 0%, white 100%);
  border-color: var(--chapter-color, #8b5cf6);
  box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
}

.md-chapter-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.md-chapter-icon-wrap {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.md-chapter-header h4 {
  margin: 0;
  font-size: 15px;
  font-weight: 600;
  color: #1e293b;
  font-family: var(--font-serif);
}

.md-chapter-header p {
  margin: 2px 0 0 0;
  font-size: 12px;
  color: #64748b;
}

.md-chapter-thumbs {
  display: flex;
  gap: 6px;
}

.md-thumb {
  width: 36px;
  height: 36px;
  border-radius: 6px;
  overflow: hidden;
  background: #f1f5f9;
}

.md-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.md-thumb-more {
  width: 36px;
  height: 36px;
  background: #e2e8f0;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 600;
  color: #64748b;
}

.md-btn-add {
  margin-top: 16px;
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 2px dashed #e2e8f0;
  background: transparent;
  color: #94a3b8;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: none;
  text-transform: none;
  letter-spacing: normal;
}

.md-btn-add:hover {
  border-color: #cbd5e1;
  color: #64748b;
  background: #f8fafc;
}

.md-ai-panel {
  margin-top: 24px;
  padding: 16px;
  background: linear-gradient(135deg, rgba(139, 92, 246, 0.08) 0%, white 100%);
  border-radius: 14px;
  border: 1px solid rgba(139, 92, 246, 0.2);
}

.md-ai-panel-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  color: #8b5cf6;
}

.md-ai-panel-header span {
  font-weight: 600;
  font-size: 13px;
  color: #334155;
}

.md-ai-panel p {
  margin: 0 0 12px 0;
  font-size: 12px;
  color: #64748b;
  line-height: 1.4;
}

.md-active-chapter {
  background: linear-gradient(135deg, color-mix(in srgb, var(--chapter-color, #8b5cf6) 8%, white) 0%, transparent 100%);
  padding: 20px 24px;
  border-radius: 16px;
  border: 1px solid color-mix(in srgb, var(--chapter-color, #8b5cf6) 20%, transparent);
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}

.md-chapter-icon-lg {
  width: 56px;
  height: 56px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.md-active-chapter h2 {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
  color: #1e293b;
}

.md-active-chapter p {
  margin: 4px 0 0 0;
  color: #64748b;
  font-size: 14px;
}

.md-spread {
  display: flex;
  gap: 8px;
  padding: 20px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  position: relative;
  margin-bottom: 16px;
  border: 2px solid transparent;
  transition: all 0.2s;
}

.md-spread:hover,
.md-spread.active {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  border-color: #e2e8f0;
}

.md-spread-gutter {
  position: absolute;
  top: 20px;
  bottom: 20px;
  left: 50%;
  width: 2px;
  background: linear-gradient(to bottom, transparent, #e2e8f0 15%, #e2e8f0 85%, transparent);
  transform: translateX(-50%);
}

.md-spread-page {
  flex: 1;
  aspect-ratio: 1;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.md-page-num {
  position: absolute;
  bottom: 4px;
  font-size: 10px;
  color: #94a3b8;
}

.md-spread-left .md-page-num {
  left: 8px;
}

.md-spread-right .md-page-num {
  right: 8px;
}

.md-photo-slot {
  width: 100%;
  height: 100%;
  border-radius: 10px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: transform 0.3s ease;
}

.md-photo-slot:hover {
  transform: scale(1.02);
}

.md-photo-slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.md-photo-caption {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 8px 12px;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
  color: white;
  font-size: 11px;
}

.md-empty-slot {
  width: 100%;
  height: 100%;
  border: 2px dashed #e2e8f0;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  color: #94a3b8;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.md-empty-slot:hover {
  border-color: #cbd5e1;
  background: #f8fafc;
}

.md-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.6);
  backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.md-modal-overlay.active {
  display: flex;
}

.md-modal-card {
  background: white;
  border-radius: 24px;
  padding: 32px;
  max-width: 480px;
  width: 90%;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  text-align: center;
  animation: mdSlideUp 0.3s ease;
}

@keyframes mdSlideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.md-modal-icon {
  width: 64px;
  height: 64px;
  border-radius: 16px;
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 16px;
}

.md-modal-card h2 {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
  color: #1e293b;
}

.md-modal-subtitle {
  color: #64748b;
  margin: 8px 0 0 0;
  font-size: 14px;
}

.md-detected-story {
  background: #f8fafc;
  border-radius: 14px;
  padding: 16px;
  margin: 24px 0;
  text-align: left;
}

.md-detected-story h3 {
  margin: 0 0 16px 0;
  font-size: 16px;
  font-weight: 600;
  color: #1e293b;
}

.md-chapter-preview {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.md-chapter-preview:last-child {
  margin-bottom: 0;
}

.md-chapter-preview .md-chapter-icon {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.md-chapter-preview .md-chapter-info {
  flex: 1;
  min-width: 0;
}

.md-chapter-preview .md-chapter-name {
  display: block;
  font-weight: 600;
  font-size: 14px;
  color: #1e293b;
}

.md-chapter-preview .md-chapter-subtitle {
  display: block;
  font-size: 12px;
  color: #64748b;
}

.md-chapter-preview .md-chapter-count {
  font-size: 12px;
  color: #94a3b8;
  flex-shrink: 0;
}

.md-modal-actions {
  display: flex;
  gap: 12px;
}

.md-modal-actions .btn {
  flex: 1;
}

.md-info-panel {
  margin-top: 20px;
  padding: 14px;
  background: #f0fdf4;
  border-radius: 12px;
  border: 1px solid #bbf7d0;
}

.md-info-panel h4 {
  margin: 0 0 8px 0;
  font-size: 13px;
  font-weight: 600;
  color: #166534;
}

.md-info-panel p {
  margin: 0 0 6px 0;
  font-size: 12px;
  color: #15803d;
  line-height: 1.4;
}

.md-info-panel p:last-child {
  margin-bottom: 0;
}

/* MD card in template gallery */
.memory-director-card .md-preview {
  background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
  position: relative;
  overflow: hidden;
  border-bottom: 1px solid var(--color-border);
}

.md-preview-icon {
  color: white;
  opacity: 0.92;
}

.md-preview-sparkle {
  position: absolute;
  top: 12px;
  right: 12px;
  color: #fbbf24;
  animation: sparkle 2s ease-in-out infinite;
}

@keyframes sparkle {

  0%,
  100% {
    opacity: 0.5;
    transform: scale(1);
  }

  50% {
    opacity: 1;
    transform: scale(1.2);
  }
}

.template-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.25rem 0.6rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 700;
  margin-top: 0.75rem;
}

.template-badge.new {
  background: linear-gradient(135deg, #8b5cf6, #6366f1);
  color: white;
}

/* Cinematic Preview */
.cinematic-preview-overlay {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cinematic-close {
  position: absolute;
  top: 20px;
  right: 24px;
  color: white;
  font-size: 32px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s;
  z-index: 10;
}

.cinematic-close:hover {
  opacity: 1;
}

.cinematic-content {
  max-width: 90vw;
  max-height: 80vh;
  position: relative;
}

.cinematic-image {
  max-width: 100%;
  max-height: 80vh;
  object-fit: contain;
  animation: cinematicFade 0.5s ease;
}

@keyframes cinematicFade {
  from {
    opacity: 0;
    transform: scale(1.02);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

.cinematic-caption {
  position: absolute;
  bottom: -40px;
  left: 0;
  right: 0;
  text-align: center;
  color: white;
  font-size: 16px;
  opacity: 0.9;
}

.cinematic-progress {
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
}

.cinematic-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transition: all 0.3s;
}

.cinematic-dot.active {
  background: white;
  transform: scale(1.3);
}

/* MD settings button group */
.md-btn-group {
  display: inline-flex;
  gap: 8px;
  flex-wrap: wrap;
}

.md-btn-group .btn.active {
  background: var(--color-primary);
  color: var(--color-bg);
}

/* Icon utility */
.icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.icon svg {
  width: 100%;
  height: 100%;
}

@media (max-width: 1024px) {
  .md-sidebar-right {
    display: none;
  }
}

@media (max-width: 768px) {
  .md-layout {
    flex-direction: column;
  }

  .md-sidebar-left {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid #e2e8f0;
    max-height: 40vh;
  }

  .md-main {
    padding: 16px;
  }
}

/* ============================================
   GLOBAL MODERN THEME OVERRIDES (Full App)
   Keeps layout logic, replaces “vintage” visuals
   ============================================ */

/* Modern tokens (override earlier :root) */
:root {
  --color-bg: #f8fafc;
  --color-bg-alt: #f1f5f9;
  --color-surface: #ffffff;
  --color-primary: #6366f1;
  /* indigo */
  --color-accent: #8b5cf6;
  /* violet */
  --color-secondary: #0ea5e9;
  /* sky */
  --color-text-main: #0f172a;
  --color-text-light: #475569;
  --color-border: #e2e8f0;
  --color-danger: #ef4444;
  --color-success: #16a34a;

  --shadow-sm: 0 1px 2px rgba(15, 23, 42, 0.06);
  --shadow-md: 0 6px 18px rgba(15, 23, 42, 0.10);
  --shadow-lg: 0 14px 40px rgba(15, 23, 42, 0.14);
  --shadow-book: 0 14px 40px rgba(15, 23, 42, 0.16);

  --radius-sm: 10px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 18px;
}

body {
  background: var(--color-bg);
  color: var(--color-text-main);
}

/* Buttons: modern (remove pressed-paper look + forced uppercase) */
.btn {
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
  text-transform: none;
  letter-spacing: normal;
  margin: 0;
  padding: 10px 14px;
  font-weight: 600;
}

.btn:active {
  transform: translateY(1px);
  box-shadow: none;
}

.btn-primary {
  background: var(--color-primary);
  color: #fff;
  border-color: color-mix(in srgb, var(--color-primary) 80%, #000);
}

.btn-primary:hover {
  background: color-mix(in srgb, var(--color-primary) 88%, #000);
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
}

.btn-secondary {
  background: #fff;
  color: var(--color-text-main);
  border-color: var(--color-border);
}

.btn-secondary:hover {
  background: var(--color-bg-alt);
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
}

.btn-small {
  padding: 8px 10px;
  font-size: 0.82rem;
}

/* Inputs: modern */
input[type="text"],
input[type="number"],
select,
textarea {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: none;
  background: #fff;
}

input[type="text"]:focus,
input[type="number"]:focus,
select:focus,
textarea:focus {
  border-color: color-mix(in srgb, var(--color-primary) 70%, #fff);
  box-shadow: 0 0 0 4px color-mix(in srgb, var(--color-primary) 20%, transparent);
  transform: none;
}

/* Header + gallery */
.gallery-header,
.header {
  background: #fff;
  border-bottom: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
}

.template-gallery-view {
  background: var(--color-bg);
}

.template-card {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
}

.template-card:hover {
  border-color: color-mix(in srgb, var(--color-primary) 40%, var(--color-border));
}

/* Editor surfaces */
.sidebar {
  background: #fff;
  border-right: 1px solid var(--color-border);
  box-shadow: none;
}

.editor {
  background: var(--color-bg);
}

.settings-panel,
.pages-toolbar,
.page-controls,
.cover-controls,
.back-cover-controls {
  background: #fff;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
}

/* Page/cover previews: remove “vintage binding” effects */
.page-preview,
.cover-preview {
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-book);
  border: 1px solid var(--color-border);
  background-image: none !important;
}

.page-preview::before,
.cover-preview::before,
.cover-preview::after {
  content: none !important;
}

/* Tabs */
.editor-tabs {
  border-radius: 999px;
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-sm);
}

.editor-tab.active {
  background: var(--color-primary);
}

/* ============================================
   ENHANCED 3D BOOK COMPATIBILITY
   ============================================ */

/* Ensure 3D previews have enough space */
.cover-preview.is-cover-3d,
.page-preview.is-book-spread {
  overflow: visible;
  background: transparent;
  background-image: none;
  border: none;
  box-shadow: none;
}

/* Remove old crease effects on 3D views (additional safety) */
.cover-preview.is-cover-3d::before,
.cover-preview.is-cover-3d::after,
.page-preview.is-book-spread::before,
.page-preview.is-book-spread:hover::before {
  content: none !important;
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* Ensure cover photo placeholder works in 3D view */
.book3d-cover-inner .cover-photo-placeholder {
  width: 100%;
  height: 55%;
  margin-bottom: 1.5rem;
  border-radius: 6px;
}

/* Page number positioning in spread view */
.book3d-page .page-number {
  position: absolute;
  bottom: 12px;
  font-size: 11px;
  color: #94a3b8;
  z-index: 5;
}

/* Layout grid in spread pages */
.book3d-page .layout-grid {
  position: absolute;
  inset: 0;
  padding: 1.5rem;
  gap: 12px;
}

/* ============================================
   ENHANCED DESIGN SYSTEM STYLES
   ============================================ */

/* ============================================
   ALIGNMENT CONTROLS
   ============================================ */

.alignment-controls {
  display: flex;
  gap: 0.5rem;
}

.btn-alignment {
  width: 44px;
  height: 44px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-surface, #ffffff);
  border: 1px solid var(--color-border, #e2e8f0);
  border-radius: var(--radius-md, 10px);
  cursor: pointer;
  transition: all 0.15s ease;
  color: var(--color-text-secondary, #64748b);
}

.btn-alignment:hover {
  border-color: var(--color-primary, #6366f1);
  color: var(--color-primary, #6366f1);
  background: rgba(99, 102, 241, 0.05);
}

.btn-alignment.active {
  background: var(--color-primary, #6366f1);
  border-color: var(--color-primary, #6366f1);
  color: white;
}

.btn-alignment svg {
  width: 18px;
  height: 18px;
}

/* ============================================
   RANGE CONTROL LAYOUT
   ============================================ */

.range-control {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.range-control input[type="range"] {
  flex: 1;
  height: 6px;
  border-radius: 3px;
  background: var(--color-bg-alt, #f1f5f9);
  appearance: none;
  -webkit-appearance: none;
}

.range-control input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  background: var(--color-primary, #6366f1);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
  transition: transform 0.15s ease;
}

.range-control input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.15);
}

.range-control input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: var(--color-primary, #6366f1);
  border-radius: 50%;
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

.range-value {
  min-width: 50px;
  text-align: right;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text-secondary, #64748b);
}

/* ============================================
   INLINE CONTROLS
   ============================================ */

.inline-controls {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.inline-controls input[type="color"] {
  width: 50px;
  height: 42px;
  padding: 4px;
  border: 1px solid var(--color-border, #e2e8f0);
  border-radius: var(--radius-md, 10px);
  cursor: pointer;
  background: var(--color-surface, #ffffff);
}

.inline-controls input[type="color"]::-webkit-color-swatch-wrapper {
  padding: 2px;
}

.inline-controls input[type="color"]::-webkit-color-swatch {
  border-radius: 6px;
  border: none;
}

/* ============================================
   CHECKBOX CONTROL
   ============================================ */

.checkbox-control {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.checkbox-control input[type="checkbox"] {
  width: 20px;
  height: 20px;
  accent-color: var(--color-primary, #6366f1);
  cursor: pointer;
}

.checkbox-control label {
  font-size: 0.9rem;
  color: var(--color-text, #1e293b);
  cursor: pointer;
}

/* ============================================
   COVER CONTROLS PANEL
   ============================================ */

.cover-controls {
  flex: 1;
  max-width: 400px;
  background: var(--color-surface, #ffffff);
  border-radius: var(--radius-lg, 14px);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
}

.cover-controls h3 {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--color-text, #1e293b);
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--color-border, #e2e8f0);
}

/* ============================================
   CONTROL GROUP
   ============================================ */

.control-group {
  margin-bottom: 1.25rem;
}

.control-group:last-child {
  margin-bottom: 0;
}

.control-group label {
  display: block;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-text-secondary, #64748b);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.5rem;
}

.control-group input[type="text"],
.control-group input[type="number"],
.control-group select,
.control-group textarea {
  width: 100%;
  padding: 0.65rem 0.85rem;
  border: 1px solid var(--color-border, #e2e8f0);
  border-radius: var(--radius-md, 10px);
  font-family: inherit;
  font-size: 0.9rem;
  /* Always use dark text for inputs - ensures readability regardless of template */
  color: #1e293b !important;
  background: var(--color-surface, #ffffff);
  transition: all 0.15s ease;
}

.control-group input:focus,
.control-group select:focus,
.control-group textarea:focus {
  outline: none;
  border-color: var(--color-primary, #6366f1);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
}

/* ============================================
   3D COVER NO BORDER CLASS
   ============================================ */

.book3d-cover-face.no-border::after {
  display: none !important;
}

/* ============================================
   BACK COVER INNER ALIGNMENT
   ============================================ */

.book3d-cover-root.is-back .book3d-cover-inner {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 2rem;
  height: 100%;
}

/* ============================================
   BACK COVER TEXT STYLING
   ============================================ */

.back-cover-text {
  line-height: 1.7;
  max-width: 85%;
}

.back-cover-subtitle {
  margin-top: 1rem;
}

.back-cover-logo {
  margin-top: 2rem;
  opacity: 0.5;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* ============================================
   TEMPLATE INDICATOR BADGE (Header)
   ============================================ */

#selectedTemplateName {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0.75rem;
  background: linear-gradient(135deg, var(--color-primary, #6366f1) 0%, var(--color-primary-light, #818cf8) 100%);
  color: white;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: 9999px;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  transition: all 0.2s ease;
}

#selectedTemplateName:empty {
  display: none;
}

/* ADD TO BOTTOM */

/* === REDESIGN OVERRIDES === */

:root {
  --app-header-height: 64px;
  --rail-width: 72px;
  --drawer-width: 280px;
  --right-sidebar-width: 300px;

  /* The "Design Offer" Palette */
  --color-brand: #00897B;
  /* Teal */
  --color-brand-hover: #00796B;
  --color-bg-canvas: #F3F4F6;
  --color-text-dark: #1F2937;
  --color-text-gray: #6B7280;
  --color-border-light: #E5E7EB;
}

/* 1. Header */
.modern-header {
  height: var(--app-header-height);
  background: #ffffff;
  border-bottom: 1px solid var(--color-border-light);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 24px;
  z-index: 50;
  position: relative;
}

.header-left,
.header-right {
  display: flex;
  align-items: center;
  gap: 16px;
}

.btn-icon-back {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-text-dark);
  padding: 8px;
  border-radius: 50%;
  transition: background 0.2s;
}

.btn-icon-back:hover {
  background: var(--color-bg-canvas);
}

.header-title-group h1 {
  font-family: 'Playfair Display', serif;
  font-size: 20px;
  font-weight: 700;
  margin: 0;
  color: var(--color-text-dark);
  line-height: 1.2;
}

.template-badge {
  display: inline-block;
  font-size: 11px;
  font-weight: 600;
  color: #059669;
  background: #D1FAE5;
  padding: 2px 8px;
  border-radius: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.btn-ghost {
  background: transparent;
  border: none;
  font-size: 14px;
  font-weight: 500;
  color: var(--color-text-gray);
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 6px;
}

.btn-ghost:hover {
  background: var(--color-bg-canvas);
  color: var(--color-text-dark);
}

.btn-generate {
  background-color: var(--color-brand);
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px 6px -1px rgba(0, 137, 123, 0.3);
  transition: all 0.2s;
}

.btn-generate:hover {
  background-color: var(--color-brand-hover);
  transform: translateY(-1px);
}

/* 2. Layout */
.modern-layout {
  display: flex;
  height: calc(100vh - var(--app-header-height));
  overflow: hidden;
  background-color: var(--color-bg-canvas);
}

/* 3. Rail Navigation */
.sidebar-rail {
  width: var(--rail-width);
  background: white;
  border-right: 1px solid var(--color-border-light);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 16px 0;
  gap: 12px;
  z-index: 40;
}

.rail-item {
  width: 56px;
  height: 60px;
  background: transparent;
  border: none;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--color-text-gray);
  transition: all 0.2s;
}

.rail-item:hover {
  background: #F9FAFB;
  color: var(--color-brand);
}

.rail-item.active {
  background: #F0FDFA;
  color: var(--color-brand);
}

.rail-icon {
  font-size: 20px;
  margin-bottom: 4px;
  display: block;
}

.rail-label {
  font-size: 10px;
  font-weight: 600;
}

.rail-spacer {
  flex: 1;
}

/* 4. Sidebar Drawer */
.sidebar-drawer {
  width: var(--drawer-width);
  background: white;
  border-right: 1px solid var(--color-border-light);
  display: flex;
  flex-direction: column;
}

.drawer-header {
  padding: 20px;
  border-bottom: 1px solid var(--color-border-light);
}

.drawer-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 700;
  color: var(--color-text-dark);
}

.drawer-header p {
  margin: 4px 0 0;
  font-size: 13px;
  color: var(--color-text-gray);
}

.drawer-body {
  padding: 20px;
  overflow-y: auto;
  flex: 1;
}

.drawer-body.no-padding {
  padding: 0;
}

/* 5. Editor Stage */
.editor-stage {
  flex: 1;
  position: relative;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.stage-toolbar.floating-pill {
  position: absolute;
  top: 24px;
  left: 40px;
  right: 40px;
  background: white;
  padding: 6px 16px;
  border-radius: 99px;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 30;
  border: 1px solid rgba(0, 0, 0, 0.05);
  justify-content: flex-start;
  flex-wrap: nowrap;
}

.btn-tool {
  background: transparent;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--color-text-dark);
  font-weight: 500;
  font-size: 13px;
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
}

.btn-tool:hover {
  background: var(--color-bg-canvas);
}

.btn-tool-accent {
  color: var(--color-brand);
  background: #F0FDFA;
  font-weight: 600;
}

.btn-tool-accent:hover {
  background: #CCFBF1;
}

.btn-tool.editor-tab.active {
  background: var(--color-brand);
  color: white;
}

.btn-tool.editor-tab.active:hover {
  background: var(--color-brand-hover);
}

.toolbar-divider {
  width: 1px;
  height: 20px;
  background: var(--color-border-light);
  flex-shrink: 0;
  margin: 0 4px;
}

.page-count {
  white-space: nowrap;
  flex-shrink: 0;
  margin: 0 8px;
}

.zoom-slider-wrapper {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
  margin-left: auto;
}

.zoom-slider {
  width: 100px;
}

.zoom-icon-small {
  font-size: 14px;
  color: var(--color-text-gray);
}

.nav-arrow {
  background: white;
  border: 1px solid var(--color-border-light);
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  color: var(--color-text-dark);
  font-size: 16px;
  transition: all 0.2s;
}

.nav-arrow:hover {
  background: var(--color-bg-canvas);
  border-color: var(--color-brand);
  color: var(--color-brand);
}

.stage-canvas-wrapper {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: auto;
  padding: 80px 40px 100px;
  /* Space for toolbar/nav */
  background-image: radial-gradient(#E5E7EB 1px, transparent 1px);
  background-size: 20px 20px;
  position: relative;
}

.stage-navigator {
  position: absolute;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 16px;
  z-index: 30;
}

.page-thumbnails-track {
  display: flex;
  gap: 8px;
  padding: 8px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--color-border-light);
}

/* 6. Right Settings Sidebar */
.settings-sidebar {
  width: var(--right-sidebar-width);
  background: white;
  border-left: 1px solid var(--color-border-light);
  display: flex;
  flex-direction: column;
}

.settings-header {
  padding: 20px;
  border-bottom: 1px solid var(--color-border-light);
}

.settings-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 700;
}

.settings-scroll-content {
  padding: 20px;
  overflow-y: auto;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.setting-card {
  background: white;
  border: 1px solid var(--color-border-light);
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.setting-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.setting-title {
  display: flex;
  align-items: center;
  gap: 8px;
}

.setting-title h4 {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
}

/* Toggle Switch (iOS style) */
.toggle-switch {
  position: relative;
  width: 40px;
  height: 22px;
  display: inline-block;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #E5E7EB;
  transition: .3s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  transition: .3s;
  border-radius: 50%;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

input:checked+.slider {
  background-color: var(--color-brand);
}

input:checked+.slider:before {
  transform: translateX(18px);
}

/* Inputs */
.modern-select,
.modern-input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid var(--color-border-light);
  border-radius: 8px;
  font-size: 13px;
  background: #F9FAFB;
  outline: none;
}

.modern-select:focus,
.modern-input:focus {
  border-color: var(--color-brand);
  background: white;
}

.modern-color-input {
  width: 40px;
  height: 40px;
  border: none;
  background: none;
  cursor: pointer;
}

.btn-outline-primary {
  border: 1px solid var(--color-brand);
  color: var(--color-brand);
  background: transparent;
  border-radius: 8px;
  padding: 12px;
  font-weight: 600;
}

.btn-outline-primary:hover {
  background: #F0FDFA;
}

.full-width {
  width: 100%;
}

/* Selected Photos Grid - 2 columns, bigger photos */
.selected-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  padding: 16px;
  overflow-y: auto;
  max-height: calc(100vh - 300px);
}

.selected-grid .selected-photo-item,
.selected-grid .photo-item {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 8px;
  overflow: hidden;
  border: 2px solid var(--color-border-light);
  cursor: pointer;
  transition: all 0.2s;
  background: var(--color-bg-canvas);
}

.selected-grid .selected-photo-item:hover,
.selected-grid .photo-item:hover {
  border-color: var(--color-brand);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 137, 123, 0.2);
}

.selected-grid .selected-photo-item img,
.selected-grid .photo-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.selected-grid .empty-state {
  grid-column: 1 / -1;
  text-align: center;
  padding: 2rem;
  color: var(--color-text-gray);
  font-size: 14px;
}

/* Editor content sections */
.editor-content {
  display: none;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

.editor-content.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

#pages-editor.active {
  display: block;
  position: relative;
}

#pages-editor .page-editor-area {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cover-settings {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2rem;
  width: 100%;
  max-width: 600px;
}

.cover-preview {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.drawer-actions-row {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.btn-text-small {
  background: transparent;
  border: none;
  color: var(--color-text-gray);
  font-size: 12px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
}

.btn-text-small:hover {
  background: var(--color-bg-canvas);
  color: var(--color-brand);
}

.badge-count {
  background: var(--color-brand);
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
}

.control-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.control-row-stack {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 12px;
}

.control-row-stack label {
  font-size: 12px;
  font-weight: 600;
  color: var(--color-text-dark);
}

.button-group {
  display: flex;
  gap: 8px;
}

.color-label {
  font-size: 12px;
  color: var(--color-text-gray);
}

.modern-number-input {
  width: 60px;
  padding: 6px 8px;
  border: 1px solid var(--color-border-light);
  border-radius: 6px;
  font-size: 13px;
  background: #F9FAFB;
  outline: none;
}

.modern-number-input:focus {
  border-color: var(--color-brand);
  background: white;
}

.setting-card-body {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.info-message {
  margin-top: 12px;
  font-size: 13px;
  color: var(--color-text-gray);
}

.editor-settings-panel {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.editor-settings-panel .setting-card {
  margin-bottom: 0;
}
/* Error Repair Placeholder */
.load-error {
  position: relative;
  background: #fff3cd !important;
  display: flex !important;
  align-items: center;
  justify-content: center;
  min-height: 100px;
}
.error-placeholder {
  cursor: pointer;
  color: #856404;
  font-weight: bold;
  font-size: 11px;
  text-align: center;
  padding: 8px;
  background: rgba(255, 255, 255, 0.9);
  border: 1px dashed #856404;
  border-radius: 4px;
  width: 90%;
}
.error-placeholder:hover {
  background: #fff;
  text-decoration: underline;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
